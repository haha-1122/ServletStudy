# Servlet Filter



필터는 서블릿 실행 전, 후에 어떤 작업을 하고자 할 때 사용한다. 예를 들어 클라이언트가 보낸 데이터의 암호를 해제한다거나, 서블릿이 실행되기 전에 필요한 자원을 미리 준비한다거나, 서블릿의 인코딩을 바꿔주거나 하는 등의 역할을 필터를 통해 처리해줄 수 있다.

필터를 만들어 주는 방법은 *javax.servlet.Filter* 인터페이스를 구현하는 클래스를 만들고, 메소드들을 오버라이딩 해주면 된다.
또한 servlet과 마찬가지로 매핑이 필요하며 매핑 방식 또한 servlet과 같다.

1.  init()

    이 메소드는 필터 객체가 생성되고 준비 작업을 위해 딱 한번 호출된다. 서블릿의 init()과 같은 용도이다. 메소드의 매개변수는 FilterConfig의 인스턴스이다. 이 인스턴스를 통해 필터 초기화 매개변수의 값을 꺼낼 수 있다.

2.  doFilter()

    필터와 매핑된 URL에 요청이 들어올때마다 doFilter()가 호출된다. 이 메소드에 필터가 할 작업을 작성하면 된다.

    filterChain은 다음 필터를 가리키고 filterChain.doFilter()는 다음 필터를 호출한다. 다음 필터가 없다면 내부적으로 서블릿의 service()를 호출한다.

    서블릿이 실행되기 전에 처리할 작업은 filterChain.doFilter() 이전에, 서블릿이 실행된 후에 처리할 작업은 filterChain.doFilter() 이후에 작성한다.

3.  destroy()

    서블릿 컨테이너는 웹 어플리케이션을 종료하기 전에 필터들에 대해 destroy()를 호출하여 마무리 작업을 한다.



### 생명주기

1.  웹 어플리케이션을 시작할 때 DD파일이나 애너테이션을 통해 필터의 인스턴스를 생성하고 init() 호출.
2.  클라이언트의 요청이 들어오면 해당하는 필터의 doFilter() 호출
3.  doFilter()에서 작업을 실행하고 다음 필터의 doFilter()호출
4.  마지막 필터까지 3을 반복
5.  마지막 필터는 서블릿의 service() 호출
6.  서블릿의 service()가 끝나면 service()를 호출했던 이전 필터로 돌아감
7.  반복해서 제일 처음 호출됐던 필터까지 돌아감.
8.  마지막으로 클라이언트에게 응답 결과를 보냄

